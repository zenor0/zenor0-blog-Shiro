function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{r as c,j as l,R as A,_ as Te}from"./index-jAOdAlND.js";import{v as ue,j as N,i as ke,k as Se,B as _,C as we,h as te,D as se,G as Ne,l as w}from"./request-C4CxcTUr.js";import{a as oe}from"./env-DbhK1WeT.js";import{p as M,r as _e,s as Me,f as Ie,h as Fe,i as Re,b as je}from"./viewport-CanWGDd3.js";import{a as B,c as re,b as G,e as K,r as H,t as v}from"./toast-p3UrKKAU.js";import{T as Oe}from"./LinkCard-CLMkUr26.js";import{M as Le,c as $e}from"./StyledButton-CQh8T4zZ.js";import{$ as Ue,_ as Ve}from"./provider-DsNnzJwC.js";import{a as ae}from"./Gallery-Ba0R2fs7.js";import{A as ze}from"./AutoResizeHeight-Cnh4uM6k.js";import{c as D,a as j}from"./helper-CaAdfMs7.js";import{u as ne,a as Ye}from"./use-motion-template-DmXtrC1t.js";import{m as Ge}from"./motion-minimal-Dibf-bmP.js";import{m as He,i as qe}from"./lodash-B3VVwmZe.js";import{u as Be}from"./use-event-callback-DcHqV0_y.js";let Ke=Object.freeze([]),We=e=>{let t=c.useRef(!1);!t.current&&(t.current=!0,e?.())},W=()=>{var e;let t=c.createContext(null),o=B(null),s=c.memo(r=>{var a;let{data:n,children:i}=r,d=(a=c.useContext(t))!==null&&a!==void 0?a:o,u=re(d);return We(()=>{u(n)}),c.useEffect(()=>{u(n)},[n]),c.useEffect(()=>(u(n),()=>{u(null)}),[]),i});return s.displayName="ModelDataProvider",{ModelDataAtomProvider:r=>{let{children:a,overrideAtom:n}=r;return l.jsx(t.Provider,{value:n??o,children:a})},ModelDataProvider:s,useModelDataSelector:(r,a)=>{var n;let i=(n=c.useContext(t))!==null&&n!==void 0?n:o,d=c.useCallback(u=>u?r(u):null,a||Ke);return G(ue(i,d))},useSetModelData:()=>re((e=c.useContext(t))!==null&&e!==void 0?e:o),useGetModelData:()=>{var r;let a=(r=c.useContext(t))!==null&&r!==void 0?r:o,n=K();return()=>n.get(a)},useModelData:()=>{var r;return G((r=c.useContext(t))!==null&&r!==void 0?r:o)},setGlobalModelData:r=>{let a=H();a.set(o,M(a.get(o),r))},getGlobalModelData:()=>H().get(o),ModelDataAtomContext:t}},ce=H();ce.get,ce.set;var m=(e=>(e.GATEWAY_CONNECT="GATEWAY_CONNECT",e.GATEWAY_DISCONNECT="GATEWAY_DISCONNECT",e.VISITOR_ONLINE="VISITOR_ONLINE",e.VISITOR_OFFLINE="VISITOR_OFFLINE",e.AUTH_FAILED="AUTH_FAILED",e.COMMENT_CREATE="COMMENT_CREATE",e.POST_CREATE="POST_CREATE",e.POST_UPDATE="POST_UPDATE",e.POST_DELETE="POST_DELETE",e.NOTE_CREATE="NOTE_CREATE",e.NOTE_UPDATE="NOTE_UPDATE",e.NOTE_DELETE="NOTE_DELETE",e.PAGE_UPDATED="PAGE_UPDATED",e.PAGE_UPDATE="PAGE_UPDATE",e.SAY_CREATE="SAY_CREATE",e.SAY_DELETE="SAY_DELETE",e.SAY_UPDATE="SAY_UPDATE",e.RECENTLY_CREATE="RECENTLY_CREATE",e.RECENTLY_DELETE="RECENTLY_DELETE",e.ACTIVITY_UPDATE_PRESENCE="ACTIVITY_UPDATE_PRESENCE",e.ACTIVITY_LEAVE_PRESENCE="ACTIVITY_LEAVE_PRESENCE",e.ARTICLE_READ_COUNT_UPDATE="ARTICLE_READ_COUNT_UPDATE",e))(m||{}),Qe=(e=>(e.Join="join",e.Leave="leave",e.UpdateSid="updateSid",e))(Qe||{}),h=(e=>(e.EditDataUpdate="editDataUpdate",e.Publish="Publish",e.Refetch="Refetch",e.SocketConnected="SocketConnected",e.SocketDisconnected="SocketDisconnected",e))(h||{});class Gt extends Event{constructor(t){super(h.Publish),this.data=t}static{this.type=h.Publish}}class Ht extends Event{static{this.type=h.Refetch}constructor(){super(h.Refetch)}}class Je extends Event{static{this.type=h.SocketConnected}constructor(){super(h.SocketConnected)}}class Xe extends Event{static{this.type=h.SocketDisconnected}constructor(){super(h.SocketDisconnected)}}class qt extends Event{constructor(t){super(h.EditDataUpdate),this.data=t}static{this.type=h.EditDataUpdate}}function Ze(e){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",...e,children:l.jsx("path",{fill:"currentColor",d:"M1 11h3v2H1v-2m3.9-7.5L3.5 4.9L5.6 7L7 5.6L4.9 3.5M13 1h-2v3h2V1m7 10v2h3v-2h-3M10 22c0 .6.4 1 1 1h2c.6 0 1-.4 1-1v-1h-4v1m9.1-18.5L17 5.6L18.4 7l2.1-2.1l-1.4-1.4M18 12c0 2.2-1.2 4.2-3 5.2V19c0 .6-.4 1-1 1h-4c-.6 0-1-.4-1-1v-1.8c-1.8-1-3-3-3-5.2c0-3.3 2.7-6 6-6s6 2.7 6 6m-2 0c0-2.21-1.79-4-4-4s-4 1.79-4 4s1.79 4 4 4s4-1.79 4-4Z"})})}function et(e){return l.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 512 512",...e,children:l.jsx("path",{fill:"currentColor",d:"M512 0C460.22 3.56 96.44 38.2 71.01 287.61c-3.09 26.66-4.84 53.44-5.99 80.24l178.87-178.69c6.25-6.25 16.4-6.25 22.65 0s6.25 16.38 0 22.63L7.04 471.03c-9.38 9.37-9.38 24.57 0 33.94c9.38 9.37 24.59 9.37 33.98 0l57.13-57.07c42.09-.14 84.15-2.53 125.96-7.36c53.48-5.44 97.02-26.47 132.58-56.54H255.74l146.79-48.88c11.25-14.89 21.37-30.71 30.45-47.12h-81.14l106.54-53.21C500.29 132.86 510.19 26.26 512 0z"})})}function tt(e){return l.jsxs("svg",{width:"1em",height:"1em",viewBox:"0 0 22 22",...e,children:[l.jsx("path",{fill:"currentColor",d:"M6 6h11.17l1 1l-1 1H6V6zm12 10H6.83l-1-1l1-1H18v2z",opacity:".3"}),l.jsx("path",{fill:"currentColor",d:"M13 10h5l3-3l-3-3h-5V2h-2v2H4v6h7v2H6l-3 3l3 3h5v4h2v-4h7v-6h-7v-2zM6 6h11.17l1 1l-1 1H6V6zm12 10H6.83l-1-1l1-1H18v2z"})]})}const st=["says"];var q=(e=>(e.RefreshToc="refresh-toc",e))(q||{}),E=(e=>(e.Home="//",e.Posts="/posts",e.Post="/posts/",e.Notes="/notes",e.Note="/notes/",e.NoteTopics="/notes/topics",e.NoteTopic="/notes/topics/",e.Timelime="/timeline",e.Login="/login",e.Page="/",e.Categories="/categories",e.Category="/categories/",e.Projects="/projects",e.Project="/projects/",e.Says="/says",e.Friends="/friends",e.Thinking="/thinking",e.PageDeletd="/common/deleted",e))(E||{});function g(e,t){let o=e;switch(e){case"/notes/":{o+=t.id,t.password&&(o+=`?password=${t.password}`);break}case"/posts/":{const s=t;o+=`${s.category}/${s.slug}`;break}case"/posts":{const s=t;o+=`?${new URLSearchParams(s).toString()}`;break}case"/timeline":{const s=t;o+=`?${new URLSearchParams(s).toString()}`;break}case"/notes/topics/":case"/categories/":case"/":{o+=t.slug;break}case"//":{o="/";break}case"/projects/":{o+=t.id;break}}return o}const I=e=>e,ot={presence:e=>I({queryKey:["activity","presence",e],queryFn:async()=>{const t=await N.activity.getPresence(e);return _e(t),t}})},rt={root:()=>I({queryKey:["aggregation"],queryFn:async()=>N.aggregate.getAggregateData("shiro").then(e=>e.$serialized),gcTime:1e3*60*10,meta:{forceHydration:!0},staleTime:ke?1e3*60*10:void 0})};c.createContext(null);c.createContext({reset(e,t){}});const at="latest",nt={byNid:(e,t)=>I({queryKey:["note",e],meta:{hydrationRoutePath:g(E.Note,{id:e}),shouldHydration:o=>{const s=o?.data;return!(s?.publicAt?Se(s?.publicAt).isAfter(new Date):!1)}},queryFn:async({queryKey:o})=>{const[,s]=o;return s===at?(await N.note.getLatest()).$serialized:{...await N.note.getNoteById(+o[1],t)}}})},ct={bySlug:e=>I({queryKey:["page",e],meta:{hydrationRoutePath:g(E.Page,{slug:e})},queryFn:async({queryKey:t})=>{const[,o]=t;return(await N.page.getBySlug(o)).$serialized}})},it={bySlug:(e,t)=>I({queryKey:["post",e,t],meta:{hydrationRoutePath:g(E.Post,{category:e,slug:t})},queryFn:async({queryKey:o})=>{const[,s,r]=o;return(await N.post.getPost(s,r)).$serialized}})},ie={aggregation:rt,note:nt,post:it,page:ct,activity:ot},{ModelDataProvider:Bt,ModelDataAtomProvider:Kt,getGlobalModelData:V,setGlobalModelData:le,useModelDataSelector:Wt,useSetModelData:Qt}=W(),{ModelDataProvider:Jt,getGlobalModelData:lt,setGlobalModelData:dt,useModelDataSelector:Xt,ModelDataAtomProvider:Zt}=W(),{ModelDataProvider:es,ModelDataAtomProvider:ts,getGlobalModelData:z,setGlobalModelData:de,useModelDataSelector:ss}=W(),y=()=>{document.dispatchEvent(new CustomEvent("impression",{detail:{action:Oe.Impression,label:"Socket Realtime Event"}}))},ut=(e,t,o)=>{switch(e){case m.VISITOR_ONLINE:case m.VISITOR_OFFLINE:{const{online:s}=t;we(s);break}case m.POST_UPDATE:{const s=t,r=z();if(!r||r.id!==s.id)break;de(a=>{const n={...t};Reflect.deleteProperty(n,"category"),Object.assign(a,n)}),v("文章已更新"),y(),r.text!==s.text&&document.dispatchEvent(new CustomEvent(q.RefreshToc));break}case m.POST_DELETE:{const s=t;location.pathname===g(E.Post,{category:s.category.slug,slug:s.slug})&&z()?.id===s.id&&(o.replace(g(E.PageDeletd,{})),v.error("文章已删除"),y());break}case m.NOTE_UPDATE:{const s=t,r=V()?.data;if(!r||r.id!==s.id)break;le(a=>{Object.assign(a.data,s)}),v("手记已更新"),y(),r.text!==s.text&&document.dispatchEvent(new CustomEvent(q.RefreshToc));break}case m.NOTE_DELETE:{const s=t;location.pathname===g(E.Note,{id:s.id})&&V()?.data.id===s.id&&(o.replace(g(E.PageDeletd,{})),v.error("手记已删除"),y());break}case m.PAGE_UPDATED:case m.PAGE_UPDATE:{const{slug:s}=t;lt()?.slug===s&&(dt(r=>{Object.assign(r,t)}),v("页面已更新"),y());break}case m.NOTE_CREATE:{const{title:s,nid:r}=t;v.success(`有新的内容发布了：「${s}」`,{onClick:()=>{window.peek(`/notes/${r}`)},iconElement:A.createElement(et),autoClose:!1}),y();break}case m.POST_CREATE:{const{title:s,category:r,slug:a}=t;v.success(`有新的内容发布了：「${s}」`,{onClick:()=>{window.peek(`/posts/${r.slug}/${a}`)},iconElement:A.createElement(tt)}),y();break}case m.RECENTLY_CREATE:{y(),location.pathname===g(E.Thinking,{})||v.success(`写下一点小思考：
${t.content}`,{autoClose:1e4,iconElement:A.createElement(Ze),onClick:()=>{o.push(g(E.Thinking,{}))}});break}case m.SAY_CREATE:{location.pathname===g(E.Says,{})&&(y(),_.setQueryData(st,s=>M(s,r=>{r?.pages?.[0].data.unshift(t)})));break}case m.ACTIVITY_UPDATE_PRESENCE:{const s=t,r=ie.activity.presence(s.roomName).queryKey,a=_.getQueryState(r);_.cancelQueries({queryKey:r}),Re(t),a?.data||_.invalidateQueries({queryKey:r});break}case m.ACTIVITY_LEAVE_PRESENCE:{const s=t;_.cancelQueries({queryKey:ie.activity.presence(s.roomName).queryKey}),Fe(s.identity);break}case m.ARTICLE_READ_COUNT_UPDATE:{const{id:s,count:r,type:a}=t;if(!r)break;switch(a){case"post":{z()?.id===s&&de(i=>{i.count.read=r});break}case"note":{V()?.data?.id===s&&le(i=>{i.data.count.read=r});break}}break}case"fn#media-update":{Ie(t);break}case"fn#ps-update":{const s=t.processInfo;Me(s);break}case"shiro#update":{v.info("站点版本已更新，请刷新页面",{onClick:()=>{location.reload()}});break}default:window.dispatchEvent(new CustomEvent(`event:${e}`,{detail:t}))}};class Q{constructor(){this.socket=null,this.worker=null,this.bindMessageHandler=t=>{t.port.onmessage=o=>{const{data:s}=o,{type:r,payload:a}=s;switch(r){case"ping":{t?.port.postMessage({type:"pong"}),console.log("[ws worker] pong");break}case"connect":{window.dispatchEvent(new Je),se(!0);const n=a;this.setSid(n);break}case"disconnect":{window.dispatchEvent(new Xe),se(!1);break}case"sid":{const n=a;this.setSid(n);break}case"message":{const n=a;if(typeof n!="string")return this.handleEvent(n.type,te(n.data));const{data:i,type:d}=JSON.parse(n);this.handleEvent(d,te(i))}}}},!oe&&Te(()=>import("./io.worker-Cg-21TN0.js"),__vite__mapDeps([]),import.meta.url).then(({default:t})=>{if(oe)return;const o=new t;this.prepare(o),this.worker=o})}async getSid(){return this.socket?.sid}setRouter(t){this.router=t}setSid(t){this.socket={...this.socket,sid:t}}prepare(t){const o=Ne.replace(/\/$/,"");this.bindMessageHandler(t),t.port.postMessage({type:"config",payload:{url:`${o}/web`}}),t.port.start(),t.port.postMessage({type:"init"})}handleEvent(t,o){window.dispatchEvent(new CustomEvent(t,{detail:o})),ut(t,o,this.router)}emit(t,o){this.worker?.port.postMessage({type:"emit",payload:{type:t,payload:o}})}reconnect(){this.worker?.port.postMessage({type:"reconnect"})}static{this.shared=new Q}}const pt=Q.shared,os=Object.freeze(Object.defineProperty({__proto__:null,socketWorker:pt},Symbol.toStringTag,{value:"Module"})),pe=e=>{const{onKeyDown:t,onCompositionStart:o,onCompositionEnd:s}=e,r=c.useRef(!1),a=c.useCallback(d=>{r.current=!0,o?.(d)},[o]),n=c.useCallback(d=>{r.current=!1,s?.(d)},[s]),i=c.useCallback(d=>{if(t?.(d),r.current){d.stopPropagation();return}},[t]);return{onCompositionEnd:n,onCompositionStart:a,onKeyDown:i}},me=c.forwardRef(({className:e,...t},o)=>{const s=pe(t);return l.jsx("input",{ref:o,className:D("min-w-0 flex-auto appearance-none rounded-lg border ring-accent/20 duration-200 sm:text-sm lg:text-base","bg-base-100 px-3 py-[calc(theme(spacing.2)-1px)] placeholder:text-zinc-400 focus:outline-none focus:ring-2 dark:bg-zinc-700/[0.15]","border-border","focus:border-accent/80 dark:text-zinc-200 dark:placeholder:text-zinc-500",t.type==="password"?"font-mono":"font-[system-ui]",e),...t,...s})});me.displayName="Input";const R={sm:"rounded-sm",md:"rounded-md",lg:"rounded-lg",xl:"rounded-xl","2xl":"rounded-2xl","3xl":"rounded-3xl",default:"rounded"},mt=c.forwardRef((e,t)=>{const{className:o,wrapperClassName:s,children:r,rounded:a="xl",bordered:n=!0,...i}=e,d=ne(0),u=ne(0),T=c.useCallback(({clientX:p,clientY:L,currentTarget:$})=>{const U=$.getBoundingClientRect();d.set(p-U.left),u.set(L-U.top)},[d,u]),b=Ye`radial-gradient(320px circle at ${d}px ${u}px, var(--spotlight-color) 0%, transparent 85%)`,f=je(),x=pe(e),[P,k]=c.useState(!1);return l.jsxs("div",{className:D("group relative h-full border ring-0 ring-accent/20 duration-200 [--spotlight-color:oklch(var(--a)_/_0.12)]",R[a],"border-transparent",P&&"border-accent/80 ring-2","dark:text-zinc-200 dark:placeholder:text-zinc-500",s),onMouseMove:T,children:[!f&&l.jsx(Ge.div,{className:j("pointer-events-none absolute inset-0 z-0 opacity-0 transition-opacity duration-500 group-hover:opacity-100",R[a]),style:{background:b},"aria-hidden":"true"}),n&&l.jsx("div",{className:j("border-border pointer-events-none absolute inset-0 z-0 border",R[a]),"aria-hidden":"true"}),l.jsx("textarea",{ref:t,className:D("size-full resize-none bg-transparent","overflow-auto px-3 py-4","!outline-none","text-neutral-900/80 dark:text-slate-100/80",R[a],o),...i,onFocus:p=>{k(!0),i.onFocus?.(p)},onBlur:p=>{k(!1),i.onBlur?.(p)},...x,onKeyDown:p=>{p.key==="Enter"&&(p.metaKey||p.ctrlKey)&&e.onCmdEnter?.(p),i.onKeyDown?.(p),x.onKeyDown?.(p)}}),r]})});mt.displayName="TextArea";const ft=c.forwardRef((e,t)=>c.createElement(Ue.label,Ve({},e,{ref:t,onMouseDown:o=>{var s;(s=e.onMouseDown)===null||s===void 0||s.call(e,o),!o.defaultPrevented&&o.detail>1&&o.preventDefault()}}))),fe=ft,Et=c.createContext({}),ht=()=>c.useContext(Et),J=c.forwardRef(({className:e,...t},o)=>{const s=ht();return l.jsx(fe,{ref:o,className:D("text-foreground-600 text-[1em] font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e,s.className),...t})});J.displayName=fe.displayName;const gt=({errorMessage:e,id:t})=>l.jsx("div",{className:"mt-2",children:l.jsx(J,{className:"text-xs font-medium text-error",htmlFor:t,children:e})}),bt=c.createContext({}),xt=()=>c.useContext(bt),Ct=A.forwardRef((e,t)=>{const{className:o,type:s,label:r,isLoading:a,errorMessage:n,isInvalid:i,endContent:d,labelPlacement:u,inputClassName:T,bindValue:b,...f}=e,x=c.useId(),P=xt(),{value:k,onChange:p,onBlur:L,onFocus:$,labelClassName:U,...be}=f,[X,Z]=A.useState(!1),xe=A.useCallback(()=>{Z(!0)},[]),Ce=A.useCallback(()=>{Z(!1)},[]),[ve,ee]=A.useState(f.value);c.useEffect(()=>{ee(f.value)},[f.value]);const[F,ye]=A.useState(!1),Ae=He({},P,e),{labelPlacement:C="top"}=Ae,De=D(P.inputClassName,e.labelClassName),Pe=D(P.inputClassName,e.inputClassName);return l.jsxs("div",{className:"flex w-full flex-col",children:[l.jsxs("div",{className:D({"flex flex-col":C==="top","flex grow flex-row items-center":C==="left"},"peer relative",o),children:[r&&l.jsx(J,{className:j({"mr-4":C==="left","mb-2 flex":C==="top"},C==="inside"&&{"absolute left-3 top-2 z-[1] select-none duration-200":!0,"text-primary":X,"bottom-2 top-2 flex items-center text-lg":!k&&!X},De),htmlFor:x,children:r}),l.jsxs("div",{className:"relative grow",children:[l.jsx("input",{id:x,value:qe(b)?ve:b,onChange:S=>{ee(S.target.value),p?.(S)},onBlur:S=>{Ce(),L?.(S)},onFocus:S=>{xe(),$?.(S)},type:s==="password"&&!F?"password":"text",className:D("flex h-10 w-full rounded-md border px-3 py-2 text-sm","focus-visible:outline-none focus-visible:ring-0 disabled:cursor-not-allowed disabled:opacity-50","border-zinc-200 bg-white placeholder:text-slate-500 focus-visible:border-primary dark:border-neutral-800 dark:bg-zinc-900",C==="inside"&&"h-auto pb-2 pt-8",s==="password"&&["pr-6",!F&&"font-mono"],a&&"pr-6",i&&"!border-red-400 !bg-red-600/50",Pe),ref:t,...be}),s==="password"&&!a&&l.jsx(Le,{className:Y({placement:C}),onClick:()=>{ye(!F)},children:l.jsx("i",{className:j("text-lg text-gray-500",F?"icon-[mingcute--eye-line]":"icon-[mingcute--eye-close-line]")})}),!a&&d&&l.jsx("div",{className:Y({placement:C}),children:d}),a&&l.jsx("div",{className:Y({placement:C}),children:l.jsx("i",{className:"loading loading-spinner size-5 text-primary/80"})})]})]}),i&&n&&l.jsx(gt,{id:x,errorMessage:n})]})}),Y=$e({base:"absolute right-2",variants:{placement:{inside:"bottom-2",left:"bottom-0 top-0 flex items-center",top:"bottom-0 top-0 flex items-center"}}});Ct.displayName="Input";B({});const Ee=c.createContext(null),he=c.createContext(null),ge=()=>c.useContext(Ee),vt=()=>c.useContext(he),yt=c.forwardRef((e,t)=>{const{showErrorMessage:o=!0,...s}=e,r=ae(()=>B({})),a=ae(()=>({showErrorMessage:o,fields:r,getField:n=>w.get(r)[n],getCurrentValues:()=>Object.fromEntries(Object.entries(w.get(r)).map(([n,i])=>{const d=i.getEl()?.value;return[n,i.transform?i.transform?.(d):d]})),addField:(n,i)=>{w.set(r,d=>({...d,[n]:i}))},removeField:n=>{w.set(r,i=>{const d={...i};return delete d[n],d})}}));return c.useImperativeHandle(t,()=>a,[a]),l.jsx(Ee.Provider,{value:a,children:l.jsx(he.Provider,{value:c.useMemo(()=>({showErrorMessage:o}),[o]),children:l.jsx(At,{...s})})})});yt.displayName="Form";const At=e=>{const{onSubmit:t,...o}=e,s=ge().fields,r=c.useCallback(async a=>{a.preventDefault();const n=w.get(s);for await(const[i,d]of Object.entries(n)){const u=d.getEl();if(!u)continue;const T=u.value,b=d.rules;for(let f=0;f<b.length;f++){const x=b[f];try{if(!await x.validator(T)){console.error(`Form validation failed, at field \`${i}\`, got value \`${T}\``),u.focus(),x.message&&w.set(s,k=>M(k,p=>{p[i].rules[f].status="error"}));return}}catch(P){console.error("validate function throw error",P);return}}}t?.(a)},[t]);return l.jsx("form",{onSubmit:r,...o,children:e.children})},O=()=>{const e=ge();if(!e)throw new Error("FormInput must be used inside <FormContext />");return e},Dt=e=>{const t=O(),{fields:o}=t;return G(ue(o,c.useCallback(s=>{if(e)return s[e]?.rules.find(r=>r.status==="error")?.message},[e])))},Pt=({rules:e,transform:t,getEl:o,name:s})=>{const r=O(),{addField:a,removeField:n}=r,i=Be(o);c.useEffect(()=>{if(e&&s)return a(s,{rules:e,getEl:i,transform:t}),()=>{n(s)}},[a,i,s,n,e,t])},Tt=e=>{const t=K(),o=O(),{fields:s}=o;return c.useCallback(()=>{t.set(s,r=>M(r,a=>{e&&a[e].rules.forEach(n=>{n.status==="error"&&(n.status="success")})}))},[s,t,e])},kt=e=>{const t=K(),o=O(),{fields:s}=o;return c.useCallback(()=>{t.set(s,r=>M(r,a=>{if(!e)return;const n=a[e].getEl()?.value;n&&a[e].rules.some(i=>{if(!i.validator(n))return i.status="error",!0})}))},[s,t,e])},St=c.memo(({className:e,rules:t,onKeyDown:o,transform:s,name:r,...a})=>{const{showErrorMessage:n}=vt(),i=c.useRef(null),d=Dt(r);Pt({rules:t||[],transform:s,getEl:()=>i.current,name:r});const u=Tt(r),T=c.useCallback(f=>{o&&o(f),u()},[o,u]),b=kt(r);return l.jsxs(l.Fragment,{children:[l.jsx(me,{name:r,ref:i,className:D(!!d&&"ring-2 ring-red-400 dark:ring-orange-700","w-full",e),type:"text",onKeyDown:T,onBlur:f=>{b(),a.onBlur?.(f)},...a}),n&&l.jsx(ze,{duration:.2,children:l.jsx("p",{className:"text-left text-sm text-red-400 dark:text-orange-700",children:d})})]})});St.displayName="FormInput";export{yt as F,me as I,ts as M,E as R,Qe as S,mt as T,es as a,St as b,Wt as c,Kt as d,Bt as e,ie as q,g as r,pt as s,ss as u,os as w};
